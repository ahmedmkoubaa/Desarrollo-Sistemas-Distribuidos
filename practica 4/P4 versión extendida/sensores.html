<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta charset="UTF-8">

		<title>Formulario sensores</title>
	</head>
	<body>
		<form name="myform" id="form" action="javascript:void(0);" onsubmit="javascript:enviar();">
			Nivel Luz: <input type="number" id="luz" min="0" max="100"/><br />
			Nivel Temperatura: <input type="number" id="temperatura"  min="-30" max="60" /><br />
			Detector de humo: <input type="number" id="humo" min="0" max="1"/><br />

			<input type="submit" value="actualizar" />
		</form>

		<label for="simulacion">Simular temperatura</label>
		<input id="simulacion" name="simulacion" type="checkbox" onmousedown="obtenerTemperatura()" value="Simular temperatura" />

		<span id="resul"></span>
	</body>
	<script type="text/javascript">

		// Para añadir un sensor basta con escribirlo en este vector
		let sensores = ["luz", "temperatura" , "humo"];


		// obtener url con la que se nos ha llamado
		var serviceURL = document.URL;

		// enviar a dicha url la peticion (al servicio)
		function enviar() {
			var valorLuz  = document.getElementById("luz").value;
			var valorTemp = document.getElementById("temperatura").value;
			var valorHumo = document.getElementById("humo").value;

			var indiceNombreFichero = serviceURL.lastIndexOf('/');
			if (indiceNombreFichero > 0) serviceURL = serviceURL.substr(0, indiceNombreFichero);

			// genero mi URL de petición simple al servicio
			url = serviceURL + "/modificar_sensores";

			// concatenamos valores de aquellos sensores que no
			// sean campos vacios y contengan algun
			sensores.forEach((sensor, i) => {
				var itemSenor = document.getElementById(sensor);

				if (itemSenor.value != "") {
					url += "/" + sensor + "/" + itemSenor.value;
				}
			});
			// creo una nueva peticion http
			var httpRequest = new XMLHttpRequest();

			// Definimos la funcion que lanzar cuando cambie el estado
			// de la peticion que hemos definido
			httpRequest.onreadystatechange = function() {

				// Cuando el estado de la peticion sea HECHOs
		    	if (httpRequest.readyState === XMLHttpRequest.DONE){

		    		// Le asignamos el valor de respuesta al elemento "resul"
		        	var resultado = document.getElementById("resul");
		        	resultado.innerHTML = httpRequest.responseText;
		        }
		    };

		   // Definimos datos de la peticion, GET, una URL a la
		   // que hacer la peticion y asincrono a true
		   // Este true indica que la peticion es asincrona por lo que no hay que esperar conexion simultanea
			httpRequest.open("GET", url, true);

			// Mandamos la peticion e indicamos que el body es null (al ser un get es null)
			httpRequest.send(null);
		}
	</script>

	<!-- Importamos modulo con funcionalidad de simulacion -->
	<script src="javascript/simulacion.js" type="text/javascript">	</script>
</html>
