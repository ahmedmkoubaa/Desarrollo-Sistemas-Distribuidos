<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>MongoDB Test</title>
	</head>
	<body>
		<div id="resultados"></div>
	</body>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">

		// actualizar lista de usuarios
		function actualizarLista(usuarios){
			var listContainer = document.getElementById('resultados');
			listContainer.innerHTML = '';

			// crear una lista con los elementos
			var listElement = document.createElement('ul');
			listContainer.appendChild(listElement);

			var num = usuarios.length;
			for(var i=0; i<num; i++) {
	            var listItem = document.createElement('li');
	            listItem.innerHTML = JSON.stringify(usuarios[i]);
	            listElement.appendChild(listItem);
	        }
	    }

	   // conectarse con nuevo cliente a lo de los sockets
		var serviceURL = document.URL;

		var urlParams = serviceURL.split('/');											// Obtener palabras separadas por /
		serviceURL = urlParams[0] + "//" + urlParams[2] + "/";			// formar direccion con protocolo, ip, port, etc

		var socket = io.connect(serviceURL);

		// comportamiento al recibir my address
		socket.on('my-address', function(data) {
			var d = new Date();

			// poner datos en base de datos
			socket.emit('poner', {host:data.host, port:data.port, time:d});

			// extraer informacion de la base de datos
			socket.emit('obtener', {host: data.host});
		});

		// obtenemos informacion y actualizaremos la lista
		socket.on('obtener', function(data) {
			actualizarLista(data);
		});

		// comportamiento al recibir disconect
		// la lista se limpiará y se desconectará
		socket.on('disconnect', function() {
			actualizarLista({});
		});

	</script>



</html>
